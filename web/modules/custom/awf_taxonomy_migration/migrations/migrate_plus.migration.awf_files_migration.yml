dependencies:
  module:
    - awf_taxonomy_migration
  enforced:
    modules:
      - awf_taxonomy_migration
id: awf_files_migration
migration_tags:
  - 'Drupal 7'
migration_group: awf_migration_group
label: 'AWF Files and Images Migration'
source:
  plugin: d7_file
  constants:
    # Copy legacy files from d7 prod site (instead of from lando/local dir.
    #file_origin: 'http://abmc-api.lndo.site/sites/default/files/files_legacy/'
    file_origin: 'https://d7-legacy-awf-website.pantheonsite.io/sites/default/files/'
    public: 'public://'
process:
  d7_file_name:
    # -
    #   plugin: skip_external_videos
    #   source: uri
    # -
      plugin: str_replace
      search: ["public://", "private://"]
      replace: ["", "private/"]
      source: uri
  d7_path:
    -
      plugin: concat
      source:
        - constants/file_origin
        - '@d7_file_name'
    -
      plugin: urlencode
  destination_path:
    -
      plugin: concat
      source:
        - constants/public
        - '@d7_file_name'
    -
      plugin: urlencode
  # fid: fid
  filename: filename
  filemime: filemime
  # filesize: filesize
  status:
    plugin: default_value
    default_value: 1
  uid:
    plugin: default_value
    default_value: 1
  uri:
    plugin: file_copy
    source:
      - '@d7_path'
      - '@destination_path'
    file_exists: 'replace'
destination:
  plugin: entity:file
migration_dependencies:
  required: {  }
  optional: {  }